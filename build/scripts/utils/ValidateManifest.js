import i from"../../_snowpack/pkg/axios.js";import{get as r,set as f}from"../../_snowpack/pkg/idb-keyval.js";import{GenerateRandomString as g}from"./ModuleScript.js";const d=["DestinySeasonDefinition","DestinyInventoryItemDefinition","DestinyObjectiveDefinition","DestinyProgressionDefinition","DestinySeasonPassDefinition","DestinyPlugSetDefinition"];var l=console.log.bind(console),n;const c=async e=>{n||(n=await i.get("https://www.bungie.net/Platform/Destiny2/Manifest/"));var t=n.data.Response.jsonWorldComponentContentPaths[window.navigator.language.split("-")[0]];return l(t),t[e]},w=async()=>{for(var e of d){var t=await r(e);if(!t){delete i.defaults.headers.common["X-API-Key"];let a=await c(e),o;o=await i.get(`https://www.bungie.net${a}`).then(s=>s).catch(s=>(l(s),i.get(`https://www.bungie.net${a}?${g(4)}=${g(4)}`))),l(o),f(e,o.data)}}},m=async()=>{let e=document.getElementById("loadingText");e.innerHTML="Downloading New Manifest";let t=setTimeout(()=>{e.innerHTML="Sorry this is taking so long, We are nearly there...",setTimeout(()=>{e.innerHTML="Again, really sorry for the long wait. Try logging out, logging back in, and restarting it all eh?"},7e3)},1e4);var a=window.localStorage.getItem("destinyManifestVersion");n=await i.get("https://www.bungie.net/Platform/Destiny2/Manifest/"),await w(),a!==n.data.Response.version&&window.localStorage.setItem("destinyManifestVersion",n.data.Response.version),clearTimeout(t)},u=async e=>{var t=await r(e);return t||(await w(),t=await r(e)),t};export{m as ValidateManifest,u as ReturnEntry};
