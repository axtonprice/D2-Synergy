import*as B from"../../_snowpack/env.js";import{itemTypeKeys as f}from"./SynergyDefinitions.js";import{LoadCharacter as C,userStruct as y}from"../user.js";const W=console.log.bind(console),v=window.localStorage,$=window.sessionStorage,k=async()=>{var e=new URLSearchParams(window.location.search),t=e.get("state");t!=window.localStorage.getItem("stateCode")?(window.localStorage.clear(),window.sessionStorage.clear(),window.location.reload()):window.localStorage.removeItem("stateCode")},O=(e,t)=>{window.location.href=`${e}?${t||""}`},T=e=>{var t;switch(e){case 0:t="Titan";break;case 1:t="Hunter";break;case 2:t="Warlock";break;default:console.error("Could not parse character, parseChar() @function")}return t},_=async e=>{let t=document.createElement("div"),r=document.createElement("img"),l=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),n=document.createElement("img"),d=document.createElement("hr");n.className="bounty",n.id=`${e.hash}`,n.src=`https://www.bungie.net${e.displayProperties.icon}`,document.querySelector("#bountyItems").appendChild(n),t.className="itemContainer",t.id=`item_${e.hash}`,t.style.display="none",document.querySelector("#overlays").appendChild(t),l.id="itemTitle",i.id="itemType",s.id="itemDesc",l.innerHTML=e.displayProperties.name,i.innerHTML=e.itemTypeDisplayName,s.innerHTML=e.displayProperties.description,document.querySelector(`#item_${e.hash}`).append(l,i,d,s);let a=e.objectiveDefinitions,m=0;for(let o=0;o<a.length;o++){let c=document.createElement("div"),p=document.createElement("div");if(a[o].progressDescription.length>=24){var u=a[o].progressDescription.slice(0,24);u.charAt(u.length-1)===" "&&(u=u.slice(0,u.length-1)),a[o].progressDescription=u+".."}c.className="itemPrgCounter",p.className="itemPrgDesc",c.id=`prgCounter_${a[o].hash}`,p.id=`prgDesc_${a[o].hash}`,document.querySelector(`#item_${e.hash}`).appendChild(c),document.querySelector(`#item_${e.hash}`).appendChild(p),p.innerHTML=a[o].progressDescription,e.progress.forEach(g=>{g.objectiveHash===a[o].hash&&(a[o].completionValue===100?c.innerHTML=`${g.progress}%`:a[o].completionValue!==100&&(c.innerHTML=`${g.progress}/${g.completionValue}`),g.complete&&m++)});let E=40/a.length==Infinity?0:40/a.length;c.style.paddingBottom="21px",p.style.paddingBottom="20px";for(let g=1;g<a.length;g++){var h=E*o;h!==0&&(c.style.paddingBottom=`${parseInt(c.style.paddingBottom.split("px")[0])+Math.trunc(h)}px`,p.style.paddingBottom=`${parseInt(p.style.paddingBottom.split("px")[0])+Math.trunc(h)}px`)}}e.progress.length===m?(e.areObjectivesComplete=!0,document.getElementById(`item_${e.hash}`).className="itemContainerComplete",document.getElementById(`${e.hash}`).style.border="1px solid rgba(182,137,67, 0.749)"):e.progress.length!==m&&(e.areObjectivesComplete=!1),e.isExpired&&!e.areObjectivesComplete?(r.className="expire",r.id=`expire_${e.hash}`,r.src="../../icons/pursuit_expired.svg",document.getElementById(`${e.hash}`).style.border="1px solid rgba(179,73,73, 0.749)"):e.areObjectivesComplete&&(r.className="complete",r.id=`complete_${e.hash}`,r.src="../../icons/pursuit_completed.svg"),document.querySelector("#bountyItems").append(r),n.addEventListener("mousemove",o=>{let c=t.style;c.display="inline-block",c.left=`${o.pageX}px`,c.top=`${o.pageY}px`}),n.addEventListener("mouseleave",o=>{t.style.display="none"})},L=()=>{document.getElementById("slider").style.display="block",document.getElementById("loadingContentContainer").style.display="block"},N=()=>{document.getElementById("slider").style.display="none",document.getElementById("loadingContentContainer").style.display="none"},D=()=>{v.clear(),$.clear(),indexedDB.deleteDatabase("keyval-store"),window.location.href=B.HOME_URL},x=e=>new Intl.NumberFormat().format(e),S=e=>e.charAt(0).toUpperCase()+e.slice(1);var w=(e,t,r)=>{var l=[],i=0;return e.forEach(s=>{let n=r.definitions[s.itemHash];if(n.itemType===26){n.progress=[];for(let m of t[s.itemInstanceId].objectives)n.progress.push(m);n.isExpired=new Date(s.expirationDate)<new Date,n.props=[];let d=n.progress.length,a=0;for(let m of n.progress)m.complete&&a++;n.isComplete=!1,d===a&&(n.isComplete=!0),l.push(n),i++}}),[l,i]},I=(e,t)=>{Object.keys(e).forEach(r=>{let l=e[r];l.length!==0&&l.forEach(i=>{t.MakeBountyElement(i),t.amountOfBounties++})})},P=(e,t)=>(e.forEach(r=>{for(let l=1;l<t.vendorKeys.length;l++)if(t.vendorKeys.length-1===l){t.bountyArr.other.push(r);break}else if(t.vendorKeys.length!==l&&r.inventory.stackUniqueLabel.includes(t.vendorKeys[l])){t.bountyArr[t.vendorKeys[l]].push(r);break}}),t.bountyArr),M=(e,t)=>(Object.keys(e).forEach(r=>{let l=e[r];l.length!==0&&l.sort(t.sortBountiesByType)}),e),j=(e,t)=>{var r=e.inventory.stackUniqueLabel,l=t.inventory.stackUniqueLabel,i,s;return r.split(".").forEach(n=>{let d=n.replace(/[0-9]/g,"");d.includes("_")?d.split("_").forEach(a=>f.includes(a)?i=a:null):f.includes(n.replace(/[0-9]/g,""))&&(i=n.replace(/[0-9]/g,""))}),l.split(".").forEach(n=>{let d=n.replace(/[0-9]/g,"");d.includes("_")?d.split("_").forEach(a=>f.includes(a)?s=a:null):f.includes(n.replace(/[0-9]/g,""))&&(s=n.replace(/[0-9]/g,""))}),f.indexOf(i)<f.indexOf(s)?-1:f.indexOf(i)>f.indexOf(s)?1:0},R=(e,t)=>{var r=0;return Object.keys(e).forEach(l=>{let i=e[l];i.length!==0&&i.forEach(s=>{for(let n=0;n<t.itemTypeKeys.length;n++){let d=s.inventory.stackUniqueLabel;if(d.includes(t.itemTypeKeys[n])){d.includes("dreaming_city")?r+=t.petraYields[t.itemTypeKeys[n]]:r+=t.baseYields[t.itemTypeKeys[n]];break}}})}),r},q=async(e,t,r,l)=>{let i=e.level+t.level,s=[];if(i>=100){let n=Math.ceil((i+1)/5)*5,d=0,a=0,m=0;s.push((n-i)*1e5-t.progressToNextLevel),Object.keys(r).forEach(h=>{r[h].forEach(o=>{let c=l[o].displayProperties;o===1968811824?d++:c.name==="Small Fireteam XP Boost"?a=a+2:c.name==="Small XP Boost"&&(m=m+2)})});let u=(i-100)/5;s[1]=d+Math.trunc(u),s[2]=a,s[3]=m,s[4]=t.progressToNextLevel,s[5]=0}else if(i<100){let n=Object.keys(r).splice(i),d=[];n.forEach(c=>{r[c].forEach(p=>{p===1968811824&&d.push(c)})});let a=d[0];s.push((a-i)*1e5-e.progressToNextLevel);let m=Object.keys(r).splice(0,i),u=0,h=0,o=0;m.forEach(c=>{r[c].forEach(p=>{let E=l[p].displayProperties;p===1968811824?u++:E.name==="Small Fireteam XP Boost"?h=h+2:E.name==="Small XP Boost"&&(o=o+2)})}),s[1]=u,s[2]=h,s[3]=o,s[4]=e.progressToNextLevel,s[5]=(e.levelCap-e.level)*1e5+e.progressToNextLevel}return s},H=async(e,t)=>Math.trunc(100*e/t),K=async(e,t)=>{var r=0;return r+=e.level,t.level!==0&&(r+=t.level),r},X=async e=>{var t=b("lastChar");t?C(t):t||C(e[Object.keys(e)[0]].classType)},A=async(e,t)=>{v.getItem("userCache")||v.setItem("userCache",JSON.stringify({}));var r=JSON.parse(v.getItem("userCache"));r[e]=t,v.setItem("userCache",JSON.stringify(r))},U=async(e,t)=>{var r=JSON.parse(v.getItem("userCache"));delete r[e],v.setItem("userCache",JSON.stringify(r))},b=(e,t)=>{var r=JSON.parse(v.getItem("userCache"));return r[e]},F=(e,t)=>{document.getElementById(`${e}`).innerHTML=t},J=async(e,t)=>{y.filterDivs={};for(let r in t)if(t[r]>1){let l=document.createElement("div"),i=document.createElement("div");l.className="filter",i.className="propName",l.id=`filter_${r}${t[r]}`,i.id=`propName_${r}${t[r]}`,i.innerHTML=`${S(r)} (${t[r]})`,y.filterDivs[`propName_${r}${t[r]}`]={},y.filterDivs[`propName_${r}${t[r]}`].element=i,document.querySelector("#filters").appendChild(l),document.querySelector(`#filter_${r}${t[r]}`).appendChild(i),l.addEventListener("click",()=>{y[e].forEach(s=>{s.props.includes(r)||(document.getElementById(`${s.hash}`).style.opacity="50%",document.getElementById(`item_${s.hash}`).style.opacity="50%",document.getElementById(`propName_${r}${t[r]}`).style.color="rgb(224, 224, 224)",y.greyOutDivs?y.greyOutDivs.includes(s.hash)||y.greyOutDivs.push(s.hash):(y.greyOutDivs=[],y.greyOutDivs.push(s.hash)))})})}},V=e=>{let t=" ",r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(let l=0;l<e;l++)t+=r.charAt(Math.floor(Math.random()*r.length));return t};export{k as VerifyState,T as ParseChar,D as Logout,L as StartLoad,N as StopLoad,_ as MakeBountyElement,O as RedirUser,x as InsertSeperators,S as CapitilizeFirstLetter,w as ParseBounties,I as PushToDOM,P as SortByGroup,M as SortByType,j as SortBountiesByType,R as CalcXpYield,q as ReturnSeasonProgressionStats,H as CalculatePercentage,K as ReturnSeasonPassLevel,X as LoadPrimaryCharacter,A as CacheAuditItem,U as CacheRemoveItem,b as CacheReturnItem,F as AddNumberToElementInner,J as CreateFilters,V as GenerateRandomString};
